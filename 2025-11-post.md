---
title: 'Evaluating AI-based molecular modelling with Physical Simulation'
author: Hao Lan
date: 2025-10-26
permalink: /posts/2025-11-XX/
tags:
  - Statictical Mechanics (Force Field) and Quantum Mechanics (DFT)
  - Atomic Neural Network Potentials
  - Enhanced Molecular Dynamics
---

## Introduction
<p style="text-align: justify;">
In my last blog post, I tested AI co-folding model for novel chemical modalities including macrocyclic molecular glue and its induced protein complexes. There are some postive feedback but no much detailed investigation was performed. As a computational chemist and cheminformation, I found it would be interesting to study and analyse these models with physics in terms of sampling effiency and energy accuracy, which could inspire some practical applications for drug discovery industry. In this new article, I would like to make some complementarity and particularly focus on two questions:

1. Which are those 'good' AI models approaching physics and also with low computational cost?

2. Can physics help to identify, refine or even rescure those 'imperfect' AI models?   
</p>

## Key Conclusions at the Begining

a. Some latest machine learning force fields (MMFFs) based on atomic neural network potentials (NNPs) reach quantum mechanics (QM) accurary for organic small molecules. They could be used as DFT surragate for energy calculation quickly, despite their speed for simulation still largely inferior to those traditional force fields with classic parameters. Moreover, the fundamental architecture of NNPs may further restrict their usage in coupled with enhanced sampling techniques such as Hamiliton replica exchange MD or metadynamics.

b. Traditional statistical mechanics could deal with most challenging chemcial systems, but there are some tricky situations (e.g., Atropisomerism) which require extra cautions. If such scenario was wrongly generated by AI, it would be even more hard for physical modelling to rescure.

c. Some mature machine learning models for predicting atomic properties in cheminformatics show benefits on computational chemistry (though in subconscious way), some of which have accelerated simulation workflow efficiently and made previously impossible parameterisation to be feasible.

d. The AI co-folding model provided hypothesis in a quick and easy way (if ignore the cost of data and training), of which structures could be further evaluated by expensive physical approaches in order to identify and reduce false postive results.

## Ligand Conformational Analysis in Solution

For organic small molecule drugs, solution-state conformations play important roles on both receptor binding events and DMPK properties. Computational/medicinal chemists often apply strategies of conformation control to restrain or even lock bioactive state in solution for reducing entropic pentalty and enhancing binding affinity on certain target. For modalities beyond the rule of five (bRo5), their folding conformations are also critical for desired permabilities and solubilities (defined as 'Chameleonicity' by Kihlberg group...) Following my previous article, the macrocyclic MG Elironrasib (Figure 1) was used again, for solution-state conformational analysis with enhanced simultion. Herein, the performance of several force fields including atomic NNPs was tested by their simulation/sampling speed and also energy accuaracy relative to QM/DFT reference.
<img />Figure 1<br>

### Choice of Sampling Approach

In small molecule simulation field, both Monte Carlo and MD are commonly used for modelling. During my PhD couple of years ago, *MacroModel* was always my first choice to sample multiple conformational minima used for NMR structure elucidation. It is a Metropolis Monte Carlo based software developed by Still group, which was acquired by Schrodinger later. Together with encrypted OPLSx force field originally from Jorgensen group, the method is very powerful to search low-energy conformers in solution. However, the pure Monte Carlo algorithm could only deal with the system with limited degrees of freedom (e.g., bond torsion and ring flip) considering ease of convergence (so it is usually just solute with implicit solvation model) and I have gradually realised the importance of explicit waters for CADD research during years in industry. Therefore, molecular dynamics with explicit waters were chosen for this study. 

The large languague models like Gemini has suggested me with several softwares and methods for such computational modelling task. With the open source spirit and also for this blog, I determinied to use *gromacs, openmm, openff, xtb, orca, pytorch* and other non-commerical modules (at least free for personal use) which I have gained the most experience with (also thanks LLM for helping me to solve few crtical coding issues).

<u>Here are 4 common force fields used in this test:</u>

1. **General AMBER Force Field (GAFF)** - A conventional small-molecule force field compatible with well-known AMBER family (used in my PhD paper previously)
2. **SAGE (OpenFF-2.2.1)** - The latest generation of small-molecule force field released by Open Force Field Initiative (I think their benchmark report to outperform GAFF)
3. **ANI2x** - The atomic neural network potential (NNP) in pioneer ANI family developed by Roitberg group, supporting most uncharged organic elements
4. **MACE** - A series of new NNPs developed after ANI (herein only the distilled small model was used for simulation due to efficiency)

The biggest chanllenge in molecular dynamics is ergodicity under Newton's law. To prevent trapping in the local minimum and enhance sampling, I added the algorithm of replica exchange (REMD) from 300K to 500K as well as solute tempering (REST) up to 600K by modifying Hamiltonians. However, this can only be applied on classic force field with explicit terms of bonding and non-bonding parameters. In NNPs, the forward calculation of energies and gradient forces is labile based on the feature of atomic positions followed by the black box of neural network (Figure 2) so there is no analytical function to modify easily in theory. The high temperatures may also raise the risk of thermal instability for the system under NNPs because most training data are DFT geometries minimised with electronic and zero-point energies in vaccum.
<img />Figure 2<br>

Because I did not compile the gromacs with plumed (a module for advanced MD) in my PC with 16 cores and Nvidia RTX5070 GPU, the REST simulation and metadynamics mentioned later was performed with openmm and corresponding tools. Honestly, there is no much difference in terms of simulation speed betweens two open platforms (though a bit slower than Desmond, a commerical software from D.E.Shaw and Schrodinger which is widely used in industry) and we have modules like parmed and openff interchange to convert among different formats of topology. 

Nevertheless, one challenge is to integrate explicit water model (i.e., TIP3P herein) with organic solute under NNPs. Traditional, such modelling is usually processed by QM/MM better with electronic embedding. Given the feasibility of speed and the charateristic of NNPs, ML/MM with mechanical embedding could be an alternative approach for this study (thanks to the tutorial from openmm workshops). For building ML/MM system, all bonding and non-bonding parameters on solute must be removed (Figure 3) and replaced by NNPs (Figure 2).

After many trials in parameterisation and testing, I managed to get the performance of different simulations on Elironrasib as summaried below:

| Methods | Ensembles | Speed | Timescale | Constraints | Enhancement | Platform |
| :---: | :---: | :---:| :---: | :---: | :---: | :---: |
| GAFF | NPT at 300K | 465 ns/day | 10 ns | H-bond | None | OpenMM |
| SAGE | NPT at 300K | 460 ns/day | 10 ns | H-bond | None | OpenMM |
| ANI2x | NPT at 300K | 1.3 ns/day | 200 ps | None | None | OpenMM |
| MACE_small | NPT at 300K | 0.72 ns/day | 100 ps | None | None | OpenMM |
| REMD SAGE | NPT (16 replica from 300K to 475K) | 35 ns/day/rep | 10 ns | H-bond | 10000 MC exchange attempts | GROMACS |
| REST SAGE | NPT (16 replica from 300K to 600K) | 21 ns/day/rep | 10 ns | H-bond | 10000 MC exchange attempts | OpenMM |
